# 智能配餐推荐系统

## 项目简介

智能配餐推荐系统是一个基于C++开发的控制台应用程序，旨在根据用户的口味偏好、营养需求和历史记录，为用户推荐科学合理的每日餐单。

## 核心功能

### 1. 用户管理
- 用户注册与登录
- 个人资料管理（年龄、体重、身高、性别、活动水平）
- 口味偏好设置（喜欢/避免的口味标签）
- 过敏源管理
- 完整的偏好管理（添加/移除标签） 🆕

### 2. 智能推荐 ⭐️优化升级
- **个性化推荐**
  - 基于用户特征的每日餐单推荐
  - 自动计算每日营养目标（热量、蛋白质、碳水化合物、脂肪）
  - 严格排除过敏源食物
  - 根据口味偏好优化推荐
- **智能算法** 🆕
  - 考虑最近10餐历史，避免重复推荐
  - 按餐型配置食物类别和营养分配比例
  - 早餐：主食40% + 蛋类30% + 奶制品20% + 水果10%
  - 午餐：主食35% + 肉类40% + 蔬菜25%
  - 晚餐：主食30% + 蔬菜30% + 豆制品25% + 肉类15%
  - 加餐：水果70% + 坚果30%

### 3. 营养计算与可视化
- 食物热量和营养成分计算
- 营养摄入进度条可视化
- 营养成分分布图表
- 每日营养目标达成情况统计

### 4. 食物数据库
- 包含50种常见食物的营养数据（v2.0新增25种）
- 支持按名称搜索食物
- 支持按类别浏览（主食、肉类、蔬菜、水果、豆制品、蛋类、奶制品、坚果）
- 详细的营养成分信息展示
- 支持按标签搜索（口味、过敏源等）

### 5. 历史餐单管理 ⭐️增强功能
- **查看功能**
  - 查看所有历史餐单（按日期分组）
  - 查看特定日期的餐单
  - 显示每日营养总计和目标完成度
- **编辑功能** 🆕
  - 添加食物到现有餐单
  - 移除餐单中的食物
  - 智能替换食物（推荐相似替代品）
- **删除功能** 🆕
  - 删除不需要的餐单记录
  - 二次确认防止误删
- **营养分析** 🆕
  - 单日营养目标对比
  - 全部历史平均对比
  - 智能状态标注（未达标/良好/超标）

### 6. 手动调整
- 创建自定义餐单
- 手动添加/删除食物
- 实时查看营养总计
- 评估推荐算法的匹配效果

### 7. 口味标签系统
- 支持多种口味标签：清淡、甜、咸、酸、辣、鲜、香
- 根据用户口味偏好优化推荐
- 避免用户不喜欢的口味

## 技术特点

- **面向对象设计**：采用清晰的类设计，包括User、Food、Meal、Database、RecommendationEngine等
- **智能推荐算法**：基于评分机制的推荐算法，综合考虑营养需求和口味偏好
- **数据持久化**：使用文本文件存储用户、食物和餐单数据
- **跨平台支持**：使用CMake构建系统，支持Windows和Linux
- **可扩展架构**：模块化设计，便于功能扩展

## 系统架构

### 核心类设计

```
User (用户类)
├── 基本信息：年龄、体重、身高、性别
├── 营养目标：每日热量、蛋白质、碳水、脂肪目标
└── 偏好设置：喜欢/避免的口味、过敏源

Food (食物类)
├── 营养成分：热量、蛋白质、碳水、脂肪、纤维
├── 口味标签：清淡、甜、咸、酸、辣等
└── 食物类别：主食、肉类、蔬菜、水果等

Meal (餐次类)
├── 基本信息：用户ID、日期、餐次类型
├── 食物列表：包含的所有食物
└── 营养总计：总热量、总蛋白质、总碳水、总脂肪

Database (数据库类)
├── 用户数据管理
├── 食物数据管理
└── 餐单数据管理

RecommendationEngine (推荐引擎类)
├── 推荐算法实现
├── 食物评分计算
└── 历史数据分析
```

## 编译和运行

### Docker 部署 (推荐) 🐳

为了简化部署过程，我们提供了 Docker 支持。您可以轻松地将系统部署为容器化应用。详细说明请参考 [部署指南](DEPLOYMENT.md)。

**快速运行：**

```bash
docker-compose run --rm meal-system
```

### 环境要求

- C++17 或更高版本
- CMake 3.10 或更高版本
- Visual Studio 2022 (Windows) 或 GCC/Clang (Linux)

### Windows (Visual Studio 2022)

1. 打开Visual Studio 2022
2. 选择"打开本地文件夹"，选择项目根目录
3. VS会自动识别CMakeLists.txt并配置项目
4. 点击"生成" -> "生成全部"
5. 运行程序

或使用CMake命令行：

```bash
mkdir build
cd build
cmake ..
cmake --build . --config Release
.\bin\Release\MealRecommendationSystem.exe
```

### Linux

```bash
mkdir build
cd build
cmake ..
make
./bin/MealRecommendationSystem
```

## 使用指南

### 1. 首次使用

1. 启动程序后选择"用户注册"
2. 输入用户名和密码
3. 填写个人信息（年龄、体重、身高、性别、活动水平）
4. 系统自动计算每日营养目标

### 2. 获取配餐推荐

1. 登录后选择"获取每日配餐推荐"
2. 系统根据您的营养需求生成早、中、晚三餐推荐
3. 查看每餐的食物组成和营养总计
4. 选择是否保存推荐餐单

### 3. 设置口味偏好

1. 进入"口味偏好设置"
2. 添加喜欢的口味标签（如：清淡、甜、鲜）
3. 添加避免的口味标签（如：辣、咸）
4. 设置过敏源（如：海鲜、坚果）

### 4. 手动调整餐单

1. 选择"手动调整餐单"
2. 创建新餐单并选择餐次类型
3. 搜索并添加食物
4. 实时查看营养总计
5. 保存自定义餐单

### 5. 查看营养分析

1. 选择"营养成分可视化"
2. 查看今日或指定日期的营养摄入
3. 对比每日营养目标的达成情况
4. 通过进度条和图表直观了解营养状况

## 数据文件说明

### data/foods.txt
食物数据库文件，格式：
```
ID|名称|热量|蛋白质|碳水化合物|脂肪|纤维|口味标签|类别
```

### data/users.txt
用户数据文件，格式：
```
ID|用户名|密码|年龄|体重|身高|性别|活动水平|卡路里目标|蛋白质目标|碳水目标|脂肪目标|喜欢标签|避免标签|过敏源
```

### data/meals.txt
餐单记录文件，格式：
```
ID|用户ID|日期|餐次类型|总热量|总蛋白质|总碳水|总脂肪|是否推荐|食物ID列表
```

## 推荐算法说明

推荐算法采用评分机制，综合考虑以下因素：

1. **营养匹配度**（权重最高）
   - 热量匹配：与目标热量的差异
   - 蛋白质匹配：与目标蛋白质的差异
   - 碳水化合物匹配
   - 脂肪匹配

2. **口味偏好**
   - 喜欢的口味标签：+30分
   - 避免的口味标签：-50分
   - 过敏源：直接排除

3. **餐次适配性**
   - 早餐：偏好主食和蛋类
   - 午餐：偏好肉类和蔬菜
   - 晚餐：偏好蔬菜和豆制品

4. **营养均衡**
   - 确保三大营养素比例合理
   - 蛋白质：25-35%
   - 碳水化合物：50-60%
   - 脂肪：20-30%

## 营养目标计算

系统使用Mifflin-St Jeor公式计算基础代谢率(BMR)：

- **男性**: BMR = 10 × 体重(kg) + 6.25 × 身高(cm) - 5 × 年龄 + 5
- **女性**: BMR = 10 × 体重(kg) + 6.25 × 身高(cm) - 5 × 年龄 - 161

根据活动水平调整：
- 久坐：BMR × 1.2
- 轻度活动：BMR × 1.375
- 中度活动：BMR × 1.55
- 重度活动：BMR × 1.725
- 非常活跃：BMR × 1.9

宏量营养素分配：
- 蛋白质：体重(kg) × 1.2g
- 碳水化合物：总热量的50% / 4 kcal/g
- 脂肪：总热量的25% / 9 kcal/g

## 项目结构

```
MealRecommendationSystem/
├── include/                    # 头文件目录
│   ├── User.h
│   ├── Food.h
│   ├── Meal.h
│   ├── Database.h
│   ├── RecommendationEngine.h
│   └── Utils.h
├── src/                        # 源文件目录
│   ├── main.cpp
│   ├── User.cpp
│   ├── Food.cpp
│   ├── Meal.cpp
│   ├── Database.cpp
│   ├── RecommendationEngine.cpp
│   └── Utils.cpp
├── data/                       # 数据文件目录
│   ├── users.txt
│   ├── foods.txt
│   └── meals.txt
├── docs/                       # 文档目录
├── CMakeLists.txt              # CMake配置文件
├── README.md                   # 项目说明文档
└── .gitignore                  # Git忽略文件配置
```

## 开发团队

本项目为专业系统能力实训项目，题目选择：第10题 - 智能配餐推荐系统

## 许可证

本项目仅用于学习和教学目的。

## 更新日志

### v2.0 Enhanced Edition (2025) 🆕
- ✨ **智能推荐优化**
  - 修复餐单ID生成bug
  - 实现历史数据加载和同步
  - 优化多样性算法（考虑最近10餐）
  - 按餐型配置营养分配比例
  - 增强评分算法
- ✨ **历史餐单管理升级**
  - 新增删除餐单功能
  - 新增编辑餐单功能（添加/移除/替换食物）
  - 新增智能食物替换推荐
  - 新增营养目标对比分析
  - 增强查看功能（日期分组、营养汇总）
- ✨ **用户偏好管理完善**
  - 实现移除偏好标签功能
  - 实现移除过敏源功能
- ✨ **食物数据库扩充**
  - 从25种扩充到50种食物
  - 新增海鲜、低脂奶制品、多种蔬菜和水果
- ✨ **代码质量提升**
  - 零警告编译
  - 类型安全优化
  - 模块化重构
- 📚 **文档完善**
  - 新增用户使用指南
  - 新增改进说明文档
  - 新增任务完成总结

### v1.0 (2025)
- 实现基本的用户管理功能
- 实现智能推荐算法
- 实现营养计算和可视化
- 实现历史记录管理
- 实现手动调整功能
- 支持口味标签系统
- 包含25种常见食物数据

## 文档资源

- **README.md** - 项目概述和快速开始
- **USER_GUIDE.md** - 详细的用户使用指南
- **IMPROVEMENTS.md** - 技术改进详细说明
- **TASK_COMPLETION_SUMMARY.md** - 任务完成总结报告

## 快速测试

```bash
# 编译项目
./build.sh

# 运行基础测试
./test_basic.sh

# 启动系统
./build/bin/MealRecommendationSystem
```

## 未来改进方向

1. ✅ ~~增加更多食物种类到数据库~~ (已完成：50种)
2. ✅ ~~实现更智能的推荐算法~~ (已完成：考虑历史、偏好、多样性)
3. 添加图形用户界面(GUI)
4. 实现机器学习推荐算法
5. 支持导出餐单（PDF/Excel）
6. 添加食物图片展示
7. 支持食谱推荐
8. 集成运动数据追踪
9. 添加社交分享功能
10. 支持多语言界面
